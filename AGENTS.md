# Codex Bridge Development Guide

This document contains instructions for developers working on the Codex Bridge MCP plugin.

## Version Locations

When bumping the version, update ALL of these files:

| File | Line | Format |
|------|------|--------|
| `codex_bridge_mcp.py` | ~18 | `BRIDGE_VERSION = "X.Y.Z"` |
| `pyproject.toml` | 3 | `version = "X.Y.Z"` |
| `.claude-plugin/plugin.json` | 3 | `"version": "X.Y.Z"` |
| `.claude-plugin/marketplace.json` | 16 | `"version": "X.Y.Z"` |

Auto-generated files (don't edit manually):
- `uv.lock` - regenerated by `uv lock`
- `codex_bridge_mcp.egg-info/PKG-INFO` - regenerated by build

## Cache Cleanup

The bridge stores session metadata locally. To clean up:

### Session Cache
```bash
# View session count
cat ~/.codex-bridge-mcp/sessions.jsonl | wc -l

# Clear all sessions (bridge will recreate file on next run)
rm ~/.codex-bridge-mcp/sessions.jsonl

# Or delete entire state directory
rm -rf ~/.codex-bridge-mcp
```

### Codex Rollout Files
```bash
# View rollout files (full conversation logs)
ls -la ~/.codex/sessions/

# Delete old rollouts (older than 7 days)
find ~/.codex/sessions -name "rollout-*.jsonl" -mtime +7 -delete

# Delete all rollouts (caution: loses all conversation history)
rm -rf ~/.codex/sessions
```

## Local Plugin Update (Claude Code)

When developing locally, you need to update the installed plugin to test changes.

### Method 1: Reinstall from Local Path (Recommended)

```bash
# 1. Navigate to the plugin directory
cd /Users/zeno/Documents/codex-bridge-mcp

# 2. Uninstall existing plugin (if installed from marketplace)
# In Claude Code: /mcp then select uninstall

# 3. Install from local path
# In Claude Code settings, add MCP server pointing to local path:
# Command: python3 /Users/zeno/Documents/codex-bridge-mcp/codex_bridge_mcp.py
```

### Method 2: Copy to Plugin Cache

```bash
# Find where Claude Code stores plugins
ls -la ~/.claude/plugins/

# Copy updated files (adjust path as needed)
cp /Users/zeno/Documents/codex-bridge-mcp/codex_bridge_mcp.py ~/.claude/plugins/codex-bridge/
cp -r /Users/zeno/Documents/codex-bridge-mcp/skills ~/.claude/plugins/codex-bridge/
```

### Method 3: Symlink Development Directory

```bash
# Remove installed plugin
rm -rf ~/.claude/plugins/codex-bridge

# Symlink to development directory
ln -s /Users/zeno/Documents/codex-bridge-mcp ~/.claude/plugins/codex-bridge
```

### Restart Claude Code

After updating the plugin, restart Claude Code to pick up changes:
1. Close all Claude Code windows
2. In terminal: `pkill -f "claude"` (if needed)
3. Reopen Claude Code

### Verify Update

```bash
# Check version via MCP tool
# Use: codex-bridge-info
# Should show: "bridgeVersion": "X.Y.Z"
```

## Development Workflow

1. Make changes to `codex_bridge_mcp.py` or skills
2. Bump version in all locations (see above)
3. Update `CHANGELOG.md`
4. Run tests: `pytest`
5. Update local plugin installation
6. Restart Claude Code
7. Test with `codex-bridge-info` to verify version

## Testing

```bash
# Run all tests
pytest

# Run with coverage
pytest --cov=. --cov-report=html

# Run specific test file
pytest tests/test_codex_mcp_client.py -v
```

## Regenerating Lock File

After changing `pyproject.toml`:

```bash
# Regenerate uv.lock
uv lock

# Or if using pip
pip install -e ".[dev]"
```
